<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram å¤šè´¦å·ç®¡ç†</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .header h1 { font-size: 22px; display: flex; align-items: center; gap: 10px; }
        .header-stats { display: flex; gap: 25px; font-size: 14px; }
        .header-stats span { display: flex; align-items: center; gap: 6px; }
        .container { max-width: 1400px; margin: 0 auto; padding: 30px; }
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 25px;
            background: rgba(255,255,255,0.05);
            padding: 5px;
            border-radius: 10px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }
        .tab:hover { background: rgba(255,255,255,0.1); }
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .card-header h3 { font-size: 18px; color: #fff; }
        .btn {
            padding: 10px 20px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(102,126,234,0.4); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #219a52; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-outline {
            background: transparent;
            border: 1px solid #667eea;
            color: #667eea;
        }
        .btn-outline:hover { background: rgba(102,126,234,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { color: #999; font-weight: 500; font-size: 12px; text-transform: uppercase; }
        tr:hover { background: rgba(255,255,255,0.03); }
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        .badge-success { background: rgba(39,174,96,0.2); color: #27ae60; }
        .badge-danger { background: rgba(231,76,60,0.2); color: #e74c3c; }
        .badge-warning { background: rgba(243,156,18,0.2); color: #f39c12; }
        .badge-info { background: rgba(52,152,219,0.2); color: #3498db; }
        .badge-premium { background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,140,0,0.3)); color: #ffd700; }
        .badge-normal { background: rgba(150,150,150,0.2); color: #999; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 13px; color: #999; }
        .form-control {
            width: 100%;
            padding: 12px 14px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .form-control:focus { outline: none; border-color: #667eea; }
        .form-control::placeholder { color: #666; }
        .form-row { display: flex; gap: 15px; }
        .form-row .form-group { flex: 1; }
        select.form-control { cursor: pointer; }

        /* Modal */
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            min-width: 420px;
            max-width: 90vw;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .modal-content h2 { margin-bottom: 8px; }
        .modal-content .subtitle { color: #999; margin-bottom: 25px; font-size: 14px; }
        .qr-container {
            width: 280px;
            height: 280px;
            margin: 0 auto 20px;
            background: white;
            border-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .qr-container img { width: 100%; height: 100%; object-fit: contain; }
        .qr-placeholder { color: #333; font-size: 14px; }
        .timer {
            font-size: 56px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 15px 0;
        }
        .timer.warning { background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%); -webkit-background-clip: text; }
        .status-text { font-size: 16px; margin: 10px 0 20px; }
        .status-waiting { color: #f39c12; }
        .status-success { color: #27ae60; }
        .status-timeout { color: #e74c3c; }
        .status-error { color: #e74c3c; }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-label { font-size: 13px; color: #999; margin-top: 5px; }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        .empty-state .icon { font-size: 48px; margin-bottom: 15px; }

        /* Proxy card */
        .proxy-item {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .proxy-info h4 { margin-bottom: 4px; font-size: 15px; }
        .proxy-info p { font-size: 13px; color: #999; }
        .proxy-actions { display: flex; gap: 8px; }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            border-radius: 10px;
            background: #27ae60;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
            z-index: 2000;
        }
        .toast.error { background: #e74c3c; }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(102,126,234,0.3);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Log item */
        .log-item {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }
        .log-item .time { color: #666; }
        .log-item .action { color: #667eea; }
        .log-item .account { color: #f39c12; }

        /* Export Modal */
        .export-content {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            margin: 15px 0;
        }

        /* ç‚¹å‡»å¤åˆ¶æ ·å¼ */
        .copyable-account-id {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            border: 1px solid transparent;
        }
        .copyable-account-id:hover {
            background: rgba(103, 126, 234, 0.15);
            border-color: rgba(103, 126, 234, 0.3);
        }
        .copyable-account-id:active {
            transform: scale(0.98);
        }
        .copyable-account-id .copy-icon {
            width: 14px;
            height: 14px;
            opacity: 0.4;
            transition: opacity 0.2s;
        }
        .copyable-account-id:hover .copy-icon {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>ğŸ“± Telegram å¤šè´¦å·ç®¡ç†</h1>
            <div class="header-stats">
                <span>ğŸ“Š æ€»è´¦å·: {{ accounts.length }}</span>
                <span>ğŸŸ¢ åœ¨çº¿: {{ onlineCount }}</span>
                <span>ğŸ”´ ç¦»çº¿: {{ offlineCount }}</span>
            </div>
        </div>

        <div class="container">
            <div class="tabs">
                <div class="tab" :class="{ active: tab === 'accounts' }" @click="tab = 'accounts'">ğŸ‘¥ è´¦å·ç®¡ç†</div>
                <div class="tab" :class="{ active: tab === 'proxies' }" @click="tab = 'proxies'">ğŸŒ ä»£ç†è®¾ç½®</div>
                <div class="tab" :class="{ active: tab === 'health' }" @click="tab = 'health'">ğŸ’Š å¥åº·ç›‘æ§</div>
                <div class="tab" :class="{ active: tab === 'stats' }" @click="tab = 'stats'">ğŸ“Š ä½¿ç”¨ç»Ÿè®¡</div>
                <div class="tab" :class="{ active: tab === 'logs' }" @click="tab = 'logs'">ğŸ“‹ æ“ä½œæ—¥å¿—</div>
                <div class="tab" :class="{ active: tab === 'templates' }" @click="tab = 'templates'">ğŸ’¬ æ¶ˆæ¯æ¨¡æ¿</div>
                <div class="tab" :class="{ active: tab === 'schedule' }" @click="tab = 'schedule'">ğŸ“… å®šæ—¶è®¡åˆ’</div>
            </div>

            <!-- è´¦å·ç®¡ç† -->
            <div v-show="tab === 'accounts'">
                <div class="card">
                    <div class="card-header">
                        <h3>è´¦å·åˆ—è¡¨</h3>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-outline" @click="showExportAllModal = true" :disabled="accounts.length === 0">ğŸ“¤ å¯¼å‡ºå…¨éƒ¨</button>
                            <button class="btn btn-outline" @click="showImportModal = true">ğŸ“¥ å¯¼å…¥Session</button>
                            <button class="btn btn-primary" @click="openQrModal">â• æ·»åŠ è´¦å·</button>
                        </div>
                    </div>

                    <div v-if="accounts.length === 0" class="empty-state">
                        <div class="icon">ğŸ“­</div>
                        <p>æš‚æ— è´¦å·ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ </p>
                    </div>

                    <table v-else>
                        <thead>
                            <tr>
                                <th>è´¦å·ID</th>
                                <th>åå­—</th>
                                <th>ç”¨æˆ·å</th>
                                <th>ç”¨æˆ·å·</th>
                                <th>ç±»å‹</th>
                                <th>çŠ¶æ€</th>
                                <th>ä¸Šæ¬¡åœ¨çº¿</th>
                                <th>ä½¿ç”¨æ¬¡æ•°</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="acc in accounts" :key="acc.account_id">
                                <td>
                                    <span
                                        @click="copyAccountId(acc.account_id)"
                                        :title="'ç‚¹å‡»å¤åˆ¶: ' + acc.account_id"
                                        style="cursor: pointer; display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 6px; transition: all 0.2s;"
                                        @mouseover="$event.target.style.background='rgba(103, 126, 234, 0.1)'"
                                        @mouseout="$event.target.style.background='transparent'"
                                    >
                                        <strong>{{ acc.account_id }}</strong>
                                        <svg style="width: 14px; height: 14px; opacity: 0.5;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </span>
                                </td>
                                <td>{{ acc.first_name || '-' }} {{ acc.last_name || '' }}</td>
                                <td>
                                    <a v-if="acc.username && acc.username !== 'N/A'" 
                                       :href="'https://t.me/' + acc.username" 
                                       target="_blank" 
                                       style="color: #667eea; text-decoration: none;">
                                        @{{ acc.username }}
                                    </a>
                                    <span v-else>-</span>
                                </td>
                                <td>{{ acc.user_id || '-' }}</td>
                                <td>
                                    <span class="badge" :class="acc.is_premium ? 'badge-premium' : 'badge-normal'">
                                        {{ acc.is_premium ? 'â­ ä¼šå‘˜' : 'æ™®é€š' }}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge" :class="acc.status === 'online' ? 'badge-success' : 'badge-danger'">
                                        {{ acc.status === 'online' ? 'åœ¨çº¿' : 'ç¦»çº¿' }}
                                    </span>
                                </td>
                                <td>{{ formatTime(acc.last_online) }}</td>
                                <td>{{ acc.use_count || 0 }}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline" @click="exportSession(acc.account_id)">å¯¼å‡º</button>
                                    <button class="btn btn-sm btn-danger" @click="deleteAccount(acc.account_id)">åˆ é™¤</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ä»£ç†è®¾ç½® -->
            <div v-show="tab === 'proxies'">
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸŒ å…¨å±€ä»£ç†</h3>
                    </div>
                    <div v-if="globalProxy && globalProxy.host" class="proxy-item">
                        <div class="proxy-info">
                            <h4>{{ globalProxy.protocol.toUpperCase() }}</h4>
                            <p>{{ globalProxy.host }}:{{ globalProxy.port }}</p>
                        </div>
                        <div class="proxy-actions">
                            <button class="btn btn-sm btn-success" @click="testGlobalProxy" :disabled="testing">
                                {{ testing ? 'æµ‹è¯•ä¸­...' : 'æµ‹è¯•' }}
                            </button>
                            <button class="btn btn-sm btn-danger" @click="removeGlobalProxy">ç§»é™¤</button>
                        </div>
                    </div>
                    <div v-else>
                        <p style="color: #999; margin-bottom: 15px;">è®¾ç½®å…¨å±€ä»£ç†åï¼Œæ‰€æœ‰è´¦å·é»˜è®¤ä½¿ç”¨æ­¤ä»£ç†è¿æ¥Telegram</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label>åè®®</label>
                                <select v-model="newGlobal.protocol" class="form-control">
                                    <option value="socks5">SOCKS5</option>
                                    <option value="http">HTTP</option>
                                    <option value="https">HTTPS</option>
                                    <option value="socks4">SOCKS4</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ä¸»æœºåœ°å€</label>
                                <input v-model="newGlobal.host" class="form-control" placeholder="127.0.0.1">
                            </div>
                            <div class="form-group">
                                <label>ç«¯å£</label>
                                <input v-model.number="newGlobal.port" type="number" class="form-control" placeholder="1080">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ç”¨æˆ·å (å¯é€‰)</label>
                                <input v-model="newGlobal.username" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>å¯†ç  (å¯é€‰)</label>
                                <input v-model="newGlobal.password" type="password" class="form-control">
                            </div>
                        </div>
                        <button class="btn btn-primary" @click="setGlobalProxy" :disabled="!newGlobal.host || !newGlobal.port">
                            è®¾ç½®å…¨å±€ä»£ç†
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ”Œ ç‹¬ç«‹ä»£ç†</h3>
                    </div>
                    <p style="color: #999; margin-bottom: 15px;">ä¸ºç‰¹å®šè´¦å·è®¾ç½®ç‹¬ç«‹ä»£ç†ï¼Œä¼˜å…ˆçº§é«˜äºå…¨å±€ä»£ç†</p>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ä»£ç†åç§°</label>
                            <input v-model="newProxy.id" class="form-control" placeholder="proxy1">
                        </div>
                        <div class="form-group">
                            <label>åè®®</label>
                            <select v-model="newProxy.protocol" class="form-control">
                                <option value="socks5">SOCKS5</option>
                                <option value="http">HTTP</option>
                                <option value="https">HTTPS</option>
                                <option value="socks4">SOCKS4</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ä¸»æœºåœ°å€</label>
                            <input v-model="newProxy.host" class="form-control" placeholder="192.168.1.100">
                        </div>
                        <div class="form-group">
                            <label>ç«¯å£</label>
                            <input v-model.number="newProxy.port" type="number" class="form-control" placeholder="1080">
                        </div>
                    </div>
                    <button class="btn btn-primary" @click="addProxy" :disabled="!newProxy.id || !newProxy.host || !newProxy.port">
                        æ·»åŠ ä»£ç†
                    </button>

                    <div v-if="proxies.length > 0" style="margin-top: 25px;">
                        <div v-for="proxy in proxies" :key="proxy.proxy_id" class="proxy-item">
                            <div class="proxy-info">
                                <h4>{{ proxy.proxy_id }} <span class="badge badge-warning">{{ proxy.protocol.toUpperCase() }}</span></h4>
                                <p>{{ proxy.host }}:{{ proxy.port }}</p>
                            </div>
                            <div class="proxy-actions">
                                <button class="btn btn-sm btn-success" @click="testProxy(proxy.proxy_id)">æµ‹è¯•</button>
                                <button class="btn btn-sm btn-danger" @click="deleteProxy(proxy.proxy_id)">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¥åº·ç›‘æ§ -->
            <div v-show="tab === 'health'">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ health.total_accounts || 0 }}</div>
                        <div class="stat-label">æ€»è´¦å·æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="-webkit-text-fill-color: #27ae60;">{{ health.online_accounts || 0 }}</div>
                        <div class="stat-label">åœ¨çº¿è´¦å·</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="-webkit-text-fill-color: #e74c3c;">{{ health.high_risk || 0 }}</div>
                        <div class="stat-label">é«˜é£é™©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="-webkit-text-fill-color: #f39c12;">{{ health.medium_risk || 0 }}</div>
                        <div class="stat-label">ä¸­é£é™©</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>âš ï¸ é£é™©è´¦å·</h3>
                        <button class="btn btn-outline btn-sm" @click="loadHealth">ğŸ”„ åˆ·æ–°</button>
                    </div>
                    <div v-if="!riskAccounts.length" class="empty-state">
                        <div class="icon">âœ…</div>
                        <p>æ‰€æœ‰è´¦å·å¥åº·çŠ¶æ€è‰¯å¥½</p>
                    </div>
                    <table v-else>
                        <thead>
                            <tr><th>è´¦å·ID</th><th>é£é™©ç­‰çº§</th><th>è¿ç»­å¤±è´¥</th><th>çŠ¶æ€</th></tr>
                        </thead>
                        <tbody>
                            <tr v-for="id in riskAccounts" :key="id">
                                <td>{{ id }}</td>
                                <td><span class="badge badge-warning">{{ healthDetails[id]?.risk_level || 'ä¸­' }}</span></td>
                                <td>{{ healthDetails[id]?.consecutive_fails || 0 }}</td>
                                <td><span class="badge" :class="healthDetails[id]?.banned ? 'badge-danger' : 'badge-warning'">
                                    {{ healthDetails[id]?.banned ? 'å¯èƒ½è¢«å°' : 'éœ€å…³æ³¨' }}
                                </span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ä½¿ç”¨ç»Ÿè®¡ -->
            <div v-show="tab === 'stats'">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.total_uses || 0 }}</div>
                        <div class="stat-label">æ€»ä½¿ç”¨æ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.total_messages_sent || 0 }}</div>
                        <div class="stat-label">æ¶ˆæ¯å‘é€æ€»æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.today_uses || 0 }}</div>
                        <div class="stat-label">ä»Šæ—¥ä½¿ç”¨</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.today_messages || 0 }}</div>
                        <div class="stat-label">ä»Šæ—¥æ¶ˆæ¯</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h3>ğŸ† æœ€æ´»è·ƒè´¦å·</h3></div>
                    <div v-if="!topAccounts.length" class="empty-state">
                        <div class="icon">ğŸ“Š</div>
                        <p>æš‚æ— ç»Ÿè®¡æ•°æ®</p>
                    </div>
                    <table v-else>
                        <thead><tr><th>æ’å</th><th>è´¦å·ID</th><th>ä½¿ç”¨æ¬¡æ•°</th></tr></thead>
                        <tbody>
                            <tr v-for="(acc, i) in topAccounts" :key="acc.account_id">
                                <td>ğŸ… #{{ i + 1 }}</td>
                                <td>{{ acc.account_id }}</td>
                                <td>{{ acc.value }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- æ“ä½œæ—¥å¿— -->
            <div v-show="tab === 'logs'">
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ“‹ æ“ä½œæ—¥å¿—</h3>
                        <button class="btn btn-outline btn-sm" @click="clearLogs">æ¸…ç©º</button>
                    </div>
                    <div v-if="!logs.length" class="empty-state">
                        <div class="icon">ğŸ“</div>
                        <p>æš‚æ— æ“ä½œè®°å½•</p>
                    </div>
                    <div v-else>
                        <div v-for="(log, i) in logs" :key="i" class="log-item">
                            <span><span class="action">{{ log.action }}</span> - <span class="account">{{ log.account }}</span> {{ log.detail }}</span>
                            <span class="time">{{ log.time }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¶ˆæ¯æ¨¡æ¿ -->
            <div v-show="tab === 'templates'">
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ’¬ æ¶ˆæ¯æ¨¡æ¿</h3>
                        <button class="btn btn-primary" @click="showTemplateModal = true">â• æ·»åŠ æ¨¡æ¿</button>
                    </div>
                    <p style="color: #999; margin-bottom: 20px;">é¢„è®¾å¸¸ç”¨æ¶ˆæ¯æ¨¡æ¿ï¼ŒAIå¯ä»¥ç›´æ¥è°ƒç”¨å‘é€</p>
                    
                    <div v-if="!templates.length" class="empty-state">
                        <div class="icon">ğŸ’¬</div>
                        <p>æš‚æ— æ¶ˆæ¯æ¨¡æ¿</p>
                    </div>
                    
                    <div v-else>
                        <div v-for="(tpl, i) in templates" :key="i" class="proxy-item" style="flex-direction: column; align-items: flex-start;">
                            <div style="display: flex; justify-content: space-between; width: 100%; margin-bottom: 10px;">
                                <div>
                                    <h4 style="margin-bottom: 4px;">{{ tpl.name }} <span class="badge badge-info">{{ tpl.category }}</span></h4>
                                </div>
                                <div class="proxy-actions">
                                    <button class="btn btn-sm btn-outline" @click="copyTemplate(tpl)">å¤åˆ¶</button>
                                    <button class="btn btn-sm btn-danger" @click="deleteTemplate(i)">åˆ é™¤</button>
                                </div>
                            </div>
                            <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; width: 100%; font-size: 13px; white-space: pre-wrap;">{{ tpl.content }}</div>
                            <div v-if="tpl.variables && tpl.variables.length" style="margin-top: 8px; font-size: 12px; color: #999;">
                                å˜é‡: {{ tpl.variables.join(', ') }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¿«æ·æ¨¡æ¿ -->
                <div class="card">
                    <div class="card-header"><h3>ğŸš€ å¿«æ·æ¨¡æ¿</h3></div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <button class="btn btn-outline btn-sm" @click="addQuickTemplate('é—®å€™', 'ä½ å¥½ï¼å¾ˆé«˜å…´è®¤è¯†ä½  ğŸ‘‹')">ğŸ‘‹ é—®å€™</button>
                        <button class="btn btn-outline btn-sm" @click="addQuickTemplate('æ„Ÿè°¢', 'éå¸¸æ„Ÿè°¢ä½ çš„å¸®åŠ©ï¼ğŸ™')">ğŸ™ æ„Ÿè°¢</button>
                        <button class="btn btn-outline btn-sm" @click="addQuickTemplate('ç¡®è®¤', 'å¥½çš„ï¼Œæ”¶åˆ°ï¼âœ…')">âœ… ç¡®è®¤</button>
                        <button class="btn btn-outline btn-sm" @click="addQuickTemplate('ç¨ç­‰', 'è¯·ç¨ç­‰ï¼Œæˆ‘é©¬ä¸Šå¤„ç† â³')">â³ ç¨ç­‰</button>
                        <button class="btn btn-outline btn-sm" @click="addQuickTemplate('å®Œæˆ', 'å·²ç»å®Œæˆäº†ï¼ğŸ‰')">ğŸ‰ å®Œæˆ</button>
                        <button class="btn btn-outline btn-sm" @click="addQuickTemplate('å†è§', 'å†è§ï¼Œç¥ä½ æœ‰ç¾å¥½çš„ä¸€å¤©ï¼ğŸ‘‹')">ğŸ‘‹ å†è§</button>
                    </div>
                </div>
            </div>

            <!-- å®šæ—¶è®¡åˆ’ -->
            <div v-show="tab === 'schedule'">
                <div class="card">
                    <div class="card-header">
                        <h3>ğŸ“… å®šæ—¶è®¡åˆ’</h3>
                        <button class="btn btn-primary" @click="showScheduleModal = true">â• æ·»åŠ è®¡åˆ’</button>
                    </div>
                    <p style="color: #999; margin-bottom: 20px;">æŸ¥çœ‹å’Œç®¡ç†AIè®¾ç½®çš„å®šæ—¶ä»»åŠ¡</p>
                    
                    <div v-if="!schedules.length" class="empty-state">
                        <div class="icon">ğŸ“…</div>
                        <p>æš‚æ— å®šæ—¶è®¡åˆ’</p>
                        <p style="font-size: 13px; margin-top: 10px;">å‘Šè¯‰AI"æ¯å¤©æ—©ä¸Š9ç‚¹å‘é€é—®å€™"å³å¯åˆ›å»ºå®šæ—¶ä»»åŠ¡</p>
                    </div>
                    
                    <div v-else>
                        <div v-for="(sch, i) in schedules" :key="i" class="proxy-item">
                            <div class="proxy-info" style="flex: 1;">
                                <h4>
                                    {{ sch.name }}
                                    <span class="badge" :class="sch.enabled ? 'badge-success' : 'badge-danger'">
                                        {{ sch.enabled ? 'å¯ç”¨' : 'ç¦ç”¨' }}
                                    </span>
                                </h4>
                                <p>{{ sch.description }}</p>
                                <p style="margin-top: 5px;">
                                    <span class="badge badge-info">{{ sch.cron || sch.time }}</span>
                                    <span style="margin-left: 10px; color: #666;">è´¦å·: {{ sch.accounts?.join(', ') || 'å…¨éƒ¨' }}</span>
                                </p>
                                <p v-if="sch.lastRun" style="font-size: 12px; color: #666; margin-top: 5px;">
                                    ä¸Šæ¬¡æ‰§è¡Œ: {{ formatTime(sch.lastRun) }}
                                </p>
                            </div>
                            <div class="proxy-actions">
                                <button class="btn btn-sm" :class="sch.enabled ? 'btn-warning' : 'btn-success'" @click="toggleSchedule(i)">
                                    {{ sch.enabled ? 'ç¦ç”¨' : 'å¯ç”¨' }}
                                </button>
                                <button class="btn btn-sm btn-danger" @click="deleteSchedule(i)">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è®¡åˆ’ç»Ÿè®¡ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ schedules.length }}</div>
                        <div class="stat-label">æ€»è®¡åˆ’æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="-webkit-text-fill-color: #27ae60;">{{ schedules.filter(s => s.enabled).length }}</div>
                        <div class="stat-label">å¯ç”¨ä¸­</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="-webkit-text-fill-color: #f39c12;">{{ todayExecutions }}</div>
                        <div class="stat-label">ä»Šæ—¥å·²æ‰§è¡Œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="-webkit-text-fill-color: #3498db;">{{ pendingExecutions }}</div>
                        <div class="stat-label">å¾…æ‰§è¡Œ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- QR/Phone Login Modal -->
        <div v-if="showQrModal" class="modal" @click.self="closeQrModal">
            <div class="modal-content" style="min-width: 450px;">
                <!-- ç™»å½•æ¨¡å¼é€‰æ‹© -->
                <div v-if="loginMode === 'select'" style="text-align: center;">
                    <h2>æ·»åŠ è´¦å·</h2>
                    <p class="subtitle">é€‰æ‹©ç™»å½•æ–¹å¼</p>
                    <div style="display: flex; gap: 15px; margin-top: 30px; justify-content: center;">
                        <button class="btn btn-primary" style="padding: 20px 30px; font-size: 16px;" @click="startQrLogin">
                            <div style="font-size: 32px; margin-bottom: 10px;">ğŸ“±</div>
                            <div>æ‰«ç ç™»å½•</div>
                            <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">å¿«é€Ÿä¾¿æ·</div>
                        </button>
                        <button class="btn btn-outline" style="padding: 20px 30px; font-size: 16px;" @click="startPhoneLogin">
                            <div style="font-size: 32px; margin-bottom: 10px;">ğŸ“</div>
                            <div>æ‰‹æœºå·ç™»å½•</div>
                            <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">æ”¯æŒå›½é™…å·ç </div>
                        </button>
                    </div>
                    <button class="btn btn-outline" @click="closeQrModal" style="margin-top: 25px;">å–æ¶ˆ</button>
                </div>

                <!-- äºŒç»´ç ç™»å½• -->
                <div v-else-if="loginMode === 'qr'">
                    <h2 style="cursor: pointer;" @click="loginMode = 'select'">â¬… æ‰«ç ç™»å½•</h2>
                    <p class="subtitle">ä½¿ç”¨ Telegram æ‰«æäºŒç»´ç æ·»åŠ è´¦å·</p>

                    <div class="qr-container">
                        <img v-if="qrCode" :src="qrCode" alt="QR Code">
                        <div v-else class="qr-placeholder">
                            <span class="loading"></span>
                        </div>
                    </div>

                    <div v-if="qrStatus === 'waiting'">
                        <div class="timer" :class="{ warning: qrRemaining <= 10 }">{{ Math.max(0, Math.floor(qrRemaining)) }}s</div>
                        <p class="status-text status-waiting">ç­‰å¾…æ‰«ç ä¸­...</p>
                        <button class="btn btn-primary" @click="refreshQr" style="margin-top: 10px;">ğŸ”„ åˆ·æ–°äºŒç»´ç </button>
                    </div>

                    <div v-else-if="qrStatus === 'success'">
                        <p class="status-text status-success" style="font-size: 24px;">âœ… ç™»å½•æˆåŠŸï¼</p>
                    </div>

                    <div v-else-if="qrStatus === 'timeout'">
                        <p class="status-text status-timeout">â±ï¸ äºŒç»´ç å·²è¿‡æœŸ</p>
                        <button class="btn btn-primary" @click="refreshQr" style="margin-top: 10px;">ğŸ”„ åˆ·æ–°äºŒç»´ç </button>
                    </div>

                    <div v-else-if="qrStatus === 'need_password'">
                        <p class="status-text" style="color: #3498db;">ğŸ” æ­¤è´¦å·å¼€å¯äº†ä¸¤æ­¥éªŒè¯</p>
                        <div class="form-group" style="margin: 20px 0; text-align: left;">
                            <label style="color: #999;">è¯·è¾“å…¥ä¸¤æ­¥éªŒè¯å¯†ç </label>
                            <input v-model="twoFaPassword" type="password" class="form-control" placeholder="è¾“å…¥å¯†ç ..." @keyup.enter="submit2FA">
                        </div>
                        <div v-if="twoFaError" style="color: #e74c3c; margin-bottom: 15px;">{{ twoFaError }}</div>
                        <button class="btn btn-primary" @click="submit2FA" :disabled="!twoFaPassword || twoFaLoading">
                            {{ twoFaLoading ? 'éªŒè¯ä¸­...' : 'æäº¤å¯†ç ' }}
                        </button>
                    </div>

                    <div v-else-if="qrStatus === 'error'">
                        <p class="status-text status-error">âŒ {{ qrError }}</p>
                        <button class="btn btn-primary" @click="refreshQr" style="margin-top: 10px;">ğŸ”„ é‡è¯•</button>
                    </div>

                    <button v-if="qrStatus !== 'success' && qrStatus !== 'need_password'" class="btn btn-outline" @click="closeQrModal" style="margin-top: 15px;">å…³é—­</button>
                    <button v-if="qrStatus === 'need_password'" class="btn btn-outline" @click="closeQrModal" style="margin-top: 15px;">å–æ¶ˆç™»å½•</button>
                </div>

                <!-- æ‰‹æœºå·ç™»å½• -->
                <div v-else-if="loginMode === 'phone'">
                    <h2 style="cursor: pointer;" @click="loginMode = 'select'">â¬… æ‰‹æœºå·ç™»å½•</h2>
                    <p class="subtitle">æ”¯æŒæ‰€æœ‰å›½é™…æ‰‹æœºå·</p>

                    <!-- æ­¥éª¤1: é€‰æ‹©åœ°åŒº+è¾“å…¥æ‰‹æœºå· -->
                    <div v-if="phoneStep === 'input'">
                        <!-- åœ°åŒºé€‰æ‹©å™¨ -->
                        <div class="form-group" style="margin: 20px 0; text-align: left;">
                            <label style="color: #999;">é€‰æ‹©å›½å®¶/åœ°åŒº</label>
                            <input v-model="countrySearch" class="form-control" placeholder="ğŸ” æœç´¢å›½å®¶/åœ°åŒº..." style="margin-bottom: 10px;">
                            <select v-model="phoneData.countryCode" class="form-control" style="margin-bottom: 10px;">
                                <option value="">-- é€‰æ‹©å›½å®¶/åœ°åŒº --</option>
                                <option v-for="country in filteredCountries" :key="country.code" :value="country.code">
                                    {{ country.flag }} {{ country.name }} (+{{ country.code }})
                                </option>
                            </select>
                            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                <button v-for="c in popularCountries" :key="c.code" @click="phoneData.countryCode = c.code"
                                    class="btn btn-sm"
                                    :class="phoneData.countryCode === c.code ? 'btn-primary' : 'btn-outline'"
                                    style="padding: 4px 8px; font-size: 12px;">
                                    {{ c.flag }} +{{ c.code }}
                                </button>
                            </div>
                        </div>
                        <!-- æ‰‹æœºå·è¾“å…¥ -->
                        <div class="form-group" style="margin: 15px 0; text-align: left;">
                            <label style="color: #999;">æ‰‹æœºå·</label>
                            <div style="display: flex; gap: 10px;">
                                <span style="padding: 12px 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #999; min-width: 70px;">
                                    {{ phoneData.countryCode ? '+' + phoneData.countryCode : '+???' }}
                                </span>
                                <input v-model="phoneData.phone" class="form-control" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" @keyup.enter="sendPhoneCode" style="flex: 1;">
                            </div>
                        </div>
                        <div v-if="phoneError" style="color: #e74c3c; margin-bottom: 15px;">{{ phoneError }}</div>
                        <button class="btn btn-primary" @click="sendPhoneCode" :disabled="!phoneData.countryCode || !phoneData.phone || phoneLoading" style="width: 100%;">
                            {{ phoneLoading ? 'å‘é€ä¸­...' : 'å‘é€éªŒè¯ç ' }}
                        </button>
                        <button class="btn btn-outline" @click="closeQrModal" style="margin-top: 10px; width: 100%;">å–æ¶ˆ</button>
                    </div>

                    <!-- æ­¥éª¤2: è¾“å…¥éªŒè¯ç  -->
                    <div v-else-if="phoneStep === 'code'">
                        <div class="form-group" style="margin: 20px 0; text-align: left;">
                            <label style="color: #999;">éªŒè¯ç </label>
                            <input v-model="phoneData.code" type="text" class="form-control" placeholder="è¾“å…¥éªŒè¯ç ..." @keyup.enter="verifyPhoneCode" maxlength="10">
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                å·²å‘é€åˆ°: +{{ phoneData.countryCode }} {{ phoneData.phone }}
                            </div>
                        </div>
                        <div v-if="phoneError" style="color: #e74c3c; margin-bottom: 15px;">{{ phoneError }}</div>
                        <button class="btn btn-primary" @click="verifyPhoneCode" :disabled="!phoneData.code || phoneLoading" style="width: 100%;">
                            {{ phoneLoading ? 'éªŒè¯ä¸­...' : 'éªŒè¯' }}
                        </button>
                        <button class="btn btn-outline" @click="phoneStep = 'input'" style="margin-top: 10px; width: 100%;">è¿”å›</button>
                    </div>

                    <!-- æ­¥éª¤3: è¾“å…¥ 2FA å¯†ç  -->
                    <div v-else-if="phoneStep === '2fa'">
                        <p class="status-text" style="color: #3498db;">ğŸ” æ­¤è´¦å·å¼€å¯äº†ä¸¤æ­¥éªŒè¯</p>
                        <div class="form-group" style="margin: 20px 0; text-align: left;">
                            <label style="color: #999;">è¯·è¾“å…¥ä¸¤æ­¥éªŒè¯å¯†ç </label>
                            <input v-model="phoneData.password" type="password" class="form-control" placeholder="è¾“å…¥å¯†ç ..." @keyup.enter="submitPhone2FA">
                        </div>
                        <div v-if="phoneError" style="color: #e74c3c; margin-bottom: 15px;">{{ phoneError }}</div>
                        <button class="btn btn-primary" @click="submitPhone2FA" :disabled="!phoneData.password || phoneLoading" style="width: 100%;">
                            {{ phoneLoading ? 'éªŒè¯ä¸­...' : 'æäº¤å¯†ç ' }}
                        </button>
                        <button class="btn btn-outline" @click="cancelPhoneLogin" style="margin-top: 10px; width: 100%;">å–æ¶ˆ</button>
                    </div>

                    <!-- ç™»å½•æˆåŠŸ -->
                    <div v-else-if="phoneStep === 'success'">
                        <p class="status-text status-success" style="font-size: 24px;">âœ… ç™»å½•æˆåŠŸï¼</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Modal -->
        <div v-if="showImportModal" class="modal" @click.self="showImportModal = false">
            <div class="modal-content" style="text-align: left; min-width: 500px;">
                <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“¥ å¯¼å…¥ Session</h2>
                <div class="form-group">
                    <label>è´¦å·ID</label>
                    <input v-model="importData.id" class="form-control" placeholder="my_account">
                </div>
                <div class="form-group">
                    <label>Session å­—ç¬¦ä¸²</label>
                    <textarea v-model="importData.session" class="form-control" rows="4" placeholder="ç²˜è´´ Session å­—ç¬¦ä¸²..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-outline" @click="showImportModal = false">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="importSession" :disabled="!importData.id || !importData.session">å¯¼å…¥</button>
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div v-if="showExportModal" class="modal" @click.self="showExportModal = false">
            <div class="modal-content" style="text-align: left; min-width: 500px;">
                <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“¤ å¯¼å‡º Session</h2>
                <p style="color: #999; margin-bottom: 10px;">è´¦å·: {{ exportData.id }}</p>
                <div class="export-content">{{ exportData.session }}</div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-outline" @click="showExportModal = false">å…³é—­</button>
                    <button class="btn btn-primary" @click="copyExport">å¤åˆ¶</button>
                </div>
            </div>
        </div>

        <!-- Export All Modal -->
        <div v-if="showExportAllModal" class="modal" @click.self="showExportAllModal = false">
            <div class="modal-content" style="text-align: left; min-width: 600px;">
                <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“¤ å¯¼å‡ºå…¨éƒ¨è´¦å·</h2>
                <div class="export-content" style="max-height: 400px;">{{ exportAllData }}</div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px;">
                    <button class="btn btn-outline" @click="showExportAllModal = false">å…³é—­</button>
                    <button class="btn btn-primary" @click="copyExportAll">å¤åˆ¶å…¨éƒ¨</button>
                </div>
            </div>
        </div>

        <!-- Template Modal -->
        <div v-if="showTemplateModal" class="modal" @click.self="showTemplateModal = false">
            <div class="modal-content" style="text-align: left; min-width: 500px;">
                <h2 style="text-align: center; margin-bottom: 20px;">ğŸ’¬ æ·»åŠ æ¶ˆæ¯æ¨¡æ¿</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>æ¨¡æ¿åç§°</label>
                        <input v-model="newTemplate.name" class="form-control" placeholder="æ—©å®‰é—®å€™">
                    </div>
                    <div class="form-group">
                        <label>åˆ†ç±»</label>
                        <select v-model="newTemplate.category" class="form-control">
                            <option value="é—®å€™">é—®å€™</option>
                            <option value="é€šçŸ¥">é€šçŸ¥</option>
                            <option value="è¥é”€">è¥é”€</option>
                            <option value="å®¢æœ">å®¢æœ</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>æ¶ˆæ¯å†…å®¹</label>
                    <textarea v-model="newTemplate.content" class="form-control" rows="4" placeholder="è¾“å…¥æ¶ˆæ¯å†…å®¹...æ”¯æŒä½¿ç”¨ {name} {time} ç­‰å˜é‡"></textarea>
                </div>
                <div class="form-group">
                    <label>å˜é‡ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
                    <input v-model="newTemplate.variablesStr" class="form-control" placeholder="name, time, date">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-outline" @click="showTemplateModal = false">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="addTemplate" :disabled="!newTemplate.content">æ·»åŠ </button>
                </div>
            </div>
        </div>

        <!-- Schedule Modal -->
        <div v-if="showScheduleModal" class="modal" @click.self="showScheduleModal = false">
            <div class="modal-content" style="text-align: left; min-width: 550px;">
                <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“… æ·»åŠ å®šæ—¶è®¡åˆ’</h2>
                <div class="form-group">
                    <label>è®¡åˆ’åç§°</label>
                    <input v-model="newSchedule.name" class="form-control" placeholder="æ¯æ—¥æ—©å®‰">
                </div>
                <div class="form-group">
                    <label>æè¿°</label>
                    <input v-model="newSchedule.description" class="form-control" placeholder="æ¯å¤©æ—©ä¸Š9ç‚¹å‘é€æ—©å®‰æ¶ˆæ¯">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>æ‰§è¡Œæ—¶é—´</label>
                        <input v-model="newSchedule.time" type="time" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>é‡å¤</label>
                        <select v-model="newSchedule.repeat" class="form-control">
                            <option value="once">ä»…ä¸€æ¬¡</option>
                            <option value="daily">æ¯å¤©</option>
                            <option value="weekly">æ¯å‘¨</option>
                            <option value="workday">å·¥ä½œæ—¥</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>æ‰§è¡ŒåŠ¨ä½œ</label>
                    <select v-model="newSchedule.action" class="form-control">
                        <option value="send_message">å‘é€æ¶ˆæ¯</option>
                        <option value="send_template">å‘é€æ¨¡æ¿</option>
                        <option value="custom">è‡ªå®šä¹‰ï¼ˆAIæ‰§è¡Œï¼‰</option>
                    </select>
                </div>
                <div v-if="newSchedule.action === 'send_message'" class="form-group">
                    <label>æ¶ˆæ¯å†…å®¹</label>
                    <textarea v-model="newSchedule.message" class="form-control" rows="3" placeholder="è¦å‘é€çš„æ¶ˆæ¯"></textarea>
                </div>
                <div v-if="newSchedule.action === 'send_template'" class="form-group">
                    <label>é€‰æ‹©æ¨¡æ¿</label>
                    <select v-model="newSchedule.template_id" class="form-control">
                        <option v-for="tpl in templates" :key="tpl.template_id || tpl.id" :value="tpl.template_id || tpl.id">{{ tpl.name }}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é€‰æ‹©è´¦å·</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                        <label v-for="acc in accounts" :key="acc.account_id" style="display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 13px;">
                            <input type="checkbox" v-model="newSchedule.accounts" :value="acc.account_id">
                            {{ acc.account_id }}
                        </label>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-outline" @click="showScheduleModal = false">å–æ¶ˆ</button>
                    <button class="btn btn-primary" @click="addSchedule" :disabled="!newSchedule.name || !newSchedule.time">æ·»åŠ </button>
                </div>
            </div>
        </div>

        <!-- Toast -->
        <div v-if="toast.show" class="toast" :class="{ error: toast.error }">{{ toast.message }}</div>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    tab: 'accounts',
                    accounts: [],
                    globalProxy: null,
                    proxies: [],
                    health: {},
                    healthDetails: {},
                    riskAccounts: [],
                    stats: {},
                    topAccounts: [],
                    testing: false,
                    logs: [],

                    // Login Modal (QR + Phone)
                    showQrModal: false,
                    loginMode: 'select', // 'select', 'qr', 'phone'
                    // QR login states
                    qrCode: '',
                    qrStatus: '',
                    qrRemaining: 30,
                    qrError: '',
                    qrAccountId: '',
                    qrPolling: null,
                    twoFaPassword: '',
                    twoFaError: '',
                    twoFaLoading: false,
                    // Phone login states
                    phoneStep: 'input', // 'input', 'code', '2fa', 'success'
                    phoneData: { phone: '', code: '', password: '', countryCode: '' },
                    phoneError: '',
                    phoneLoading: false,
                    phoneAccountId: '',
                    countrySearch: '',

                    // å›½å®¶/åœ°åŒºä»£ç æ•°æ®ï¼ˆå»é‡ï¼‰
                    countries: (() => {
                        const all = [
                            // äºšæ´²
                            { code: '86', name: 'ä¸­å›½', flag: 'ğŸ‡¨ğŸ‡³' },
                            { code: '852', name: 'é¦™æ¸¯', flag: 'ğŸ‡­ğŸ‡°' },
                            { code: '853', name: 'æ¾³é—¨', flag: 'ğŸ‡²ğŸ‡´' },
                            { code: '886', name: 'å°æ¹¾', flag: 'ğŸ‡¹ğŸ‡¼' },
                            { code: '81', name: 'æ—¥æœ¬', flag: 'ğŸ‡¯ğŸ‡µ' },
                            { code: '82', name: 'éŸ©å›½', flag: 'ğŸ‡°ğŸ‡·' },
                            { code: '850', name: 'æœé²œ', flag: 'ğŸ‡°ğŸ‡µ' },
                            { code: '65', name: 'æ–°åŠ å¡', flag: 'ğŸ‡¸ğŸ‡¬' },
                            { code: '60', name: 'é©¬æ¥è¥¿äºš', flag: 'ğŸ‡²ğŸ‡¾' },
                            { code: '66', name: 'æ³°å›½', flag: 'ğŸ‡¹ğŸ‡­' },
                            { code: '84', name: 'è¶Šå—', flag: 'ğŸ‡»ğŸ‡³' },
                            { code: '62', name: 'å°å°¼', flag: 'ğŸ‡®ğŸ‡©' },
                            { code: '63', name: 'è²å¾‹å®¾', flag: 'ğŸ‡µğŸ‡­' },
                            { code: '855', name: 'æŸ¬åŸ”å¯¨', flag: 'ğŸ‡°ğŸ‡­' },
                            { code: '856', name: 'è€æŒ', flag: 'ğŸ‡±ğŸ‡¦' },
                            { code: '95', name: 'ç¼…ç”¸', flag: 'ğŸ‡²ğŸ‡²' },
                            { code: '673', name: 'æ–‡è±', flag: 'ğŸ‡§ğŸ‡³' },
                            { code: '91', name: 'å°åº¦', flag: 'ğŸ‡®ğŸ‡³' },
                            { code: '92', name: 'å·´åŸºæ–¯å¦', flag: 'ğŸ‡µğŸ‡°' },
                            { code: '880', name: 'å­ŸåŠ æ‹‰å›½', flag: 'ğŸ‡§ğŸ‡©' },
                            { code: '94', name: 'æ–¯é‡Œå…°å¡', flag: 'ğŸ‡±ğŸ‡°' },
                            { code: '93', name: 'é˜¿å¯Œæ±—', flag: 'ğŸ‡¦ğŸ‡«' },
                            { code: '975', name: 'ä¸ä¸¹', flag: 'ğŸ‡§ğŸ‡¹' },
                            { code: '977', name: 'å°¼æ³Šå°”', flag: 'ğŸ‡³ğŸ‡µ' },
                            { code: '960', name: 'é©¬å°”ä»£å¤«', flag: 'ğŸ‡²ğŸ‡»' },
                            { code: '98', name: 'ä¼Šæœ—', flag: 'ğŸ‡®ğŸ‡·' },
                            { code: '966', name: 'æ²™ç‰¹', flag: 'ğŸ‡¸ğŸ‡¦' },
                            { code: '971', name: 'é˜¿è”é…‹', flag: 'ğŸ‡¦ğŸ‡ª' },
                            { code: '968', name: 'é˜¿æ›¼', flag: 'ğŸ‡´ğŸ‡²' },
                            { code: '974', name: 'å¡å¡”å°”', flag: 'ğŸ‡¶ğŸ‡¦' },
                            { code: '965', name: 'ç§‘å¨ç‰¹', flag: 'ğŸ‡°ğŸ‡¼' },
                            { code: '973', name: 'å·´æ—', flag: 'ğŸ‡§ğŸ‡­' },
                            { code: '962', name: 'çº¦æ—¦', flag: 'ğŸ‡¯ğŸ‡´' },
                            { code: '964', name: 'ä¼Šæ‹‰å…‹', flag: 'ğŸ‡®ğŸ‡¶' },
                            { code: '961', name: 'é»å·´å«©', flag: 'ğŸ‡±ğŸ‡§' },
                            { code: '963', name: 'å™åˆ©äºš', flag: 'ğŸ‡¸ğŸ‡¾' },
                            { code: '967', name: 'ä¹Ÿé—¨', flag: 'ğŸ‡¾ğŸ‡ª' },
                            { code: '970', name: 'å·´å‹’æ–¯å¦', flag: 'ğŸ‡µğŸ‡¸' },
                            { code: '972', name: 'ä»¥è‰²åˆ—', flag: 'ğŸ‡®ğŸ‡±' },
                            { code: '90', name: 'åœŸè€³å…¶', flag: 'ğŸ‡¹ğŸ‡·' },
                            { code: '994', name: 'é˜¿å¡æ‹œç–†', flag: 'ğŸ‡¦ğŸ‡¿' },
                            { code: '995', name: 'æ ¼é²å‰äºš', flag: 'ğŸ‡¬ğŸ‡ª' },
                            { code: '374', name: 'äºšç¾å°¼äºš', flag: 'ğŸ‡¦ğŸ‡²' },
                            { code: '7', name: 'ä¿„ç½—æ–¯', flag: 'ğŸ‡·ğŸ‡º' },
                            { code: '998', name: 'ä¹Œå…¹åˆ«å…‹æ–¯å¦', flag: 'ğŸ‡ºğŸ‡¿' },
                            { code: '992', name: 'å¡”å‰å…‹æ–¯å¦', flag: 'ğŸ‡¹ğŸ‡¯' },
                            { code: '996', name: 'å‰å°”å‰æ–¯æ–¯å¦', flag: 'ğŸ‡°ğŸ‡¬' },
                            { code: '993', name: 'åœŸåº“æ›¼æ–¯å¦', flag: 'ğŸ‡¹ğŸ‡²' },
                            { code: '380', name: 'ä¹Œå…‹å…°', flag: 'ğŸ‡ºğŸ‡¦' },
                            { code: '375', name: 'ç™½ä¿„ç½—æ–¯', flag: 'ğŸ‡§ğŸ‡¾' },
                            { code: '373', name: 'æ‘©å°”å¤šç“¦', flag: 'ğŸ‡²ğŸ‡©' },
                            { code: '997', name: 'å“ˆè¨å…‹æ–¯å¦', flag: 'ğŸ‡°ğŸ‡¿' },
                            { code: '670', name: 'ä¸œå¸æ±¶', flag: 'ğŸ‡¹ğŸ‡±' },
                            { code: '61', name: 'æ¾³å¤§åˆ©äºš', flag: 'ğŸ‡¦ğŸ‡º' },
                            { code: '64', name: 'æ–°è¥¿å…°', flag: 'ğŸ‡³ğŸ‡¿' },
                            { code: '675', name: 'å·´å¸ƒäºšæ–°å‡ å†…äºš', flag: 'ğŸ‡µğŸ‡¬' },
                            { code: '676', name: 'æ±¤åŠ ', flag: 'ğŸ‡¹ğŸ‡´' },
                            { code: '679', name: 'æ–æµ', flag: 'ğŸ‡«ğŸ‡¯' },
                            { code: '682', name: 'åº“å…‹ç¾¤å²›', flag: 'ğŸ‡¨ğŸ‡°' },
                            { code: '685', name: 'è¨æ‘©äºš', flag: 'ğŸ‡¼ğŸ‡¸' },
                            { code: '677', name: 'æ‰€ç½—é—¨ç¾¤å²›', flag: 'ğŸ‡¸ğŸ‡§' },
                            { code: '678', name: 'ç“¦åŠªé˜¿å›¾', flag: 'ğŸ‡»ğŸ‡º' },
                            { code: '683', name: 'çº½åŸƒ', flag: 'ğŸ‡³ğŸ‡º' },
                            { code: '686', name: 'åŸºé‡Œå·´æ–¯', flag: 'ğŸ‡°ğŸ‡®' },
                            { code: '688', name: 'å›¾ç“¦å¢', flag: 'ğŸ‡¹ğŸ‡»' },
                            { code: '689', name: 'æ³•å±æ³¢åˆ©å°¼è¥¿äºš', flag: 'ğŸ‡µğŸ‡«' },
                            { code: '680', name: 'å¸•åŠ³', flag: 'ğŸ‡µğŸ‡¼' },
                            { code: '691', name: 'å¯†å…‹ç½—å°¼è¥¿äºš', flag: 'ğŸ‡«ğŸ‡²' },
                            { code: '692', name: 'é©¬ç»å°”ç¾¤å²›', flag: 'ğŸ‡²ğŸ‡­' },
                            { code: '674', name: 'ç‘™é²', flag: 'ğŸ‡³ğŸ‡·' },
                            // æ¬§æ´²
                            { code: '44', name: 'è‹±å›½', flag: 'ğŸ‡¬ğŸ‡§' },
                            { code: '49', name: 'å¾·å›½', flag: 'ğŸ‡©ğŸ‡ª' },
                            { code: '33', name: 'æ³•å›½', flag: 'ğŸ‡«ğŸ‡·' },
                            { code: '39', name: 'æ„å¤§åˆ©', flag: 'ğŸ‡®ğŸ‡¹' },
                            { code: '34', name: 'è¥¿ç­ç‰™', flag: 'ğŸ‡ªğŸ‡¸' },
                            { code: '351', name: 'è‘¡è„ç‰™', flag: 'ğŸ‡µğŸ‡¹' },
                            { code: '31', name: 'è·å…°', flag: 'ğŸ‡³ğŸ‡±' },
                            { code: '32', name: 'æ¯”åˆ©æ—¶', flag: 'ğŸ‡§ğŸ‡ª' },
                            { code: '41', name: 'ç‘å£«', flag: 'ğŸ‡¨ğŸ‡­' },
                            { code: '43', name: 'å¥¥åœ°åˆ©', flag: 'ğŸ‡¦ğŸ‡¹' },
                            { code: '46', name: 'ç‘å…¸', flag: 'ğŸ‡¸ğŸ‡ª' },
                            { code: '47', name: 'æŒªå¨', flag: 'ğŸ‡³ğŸ‡´' },
                            { code: '45', name: 'ä¸¹éº¦', flag: 'ğŸ‡©ğŸ‡°' },
                            { code: '358', name: 'èŠ¬å…°', flag: 'ğŸ‡«ğŸ‡®' },
                            { code: '354', name: 'å†°å²›', flag: 'ğŸ‡®ğŸ‡¸' },
                            { code: '353', name: 'çˆ±å°”å…°', flag: 'ğŸ‡®ğŸ‡ª' },
                            { code: '352', name: 'å¢æ£®å ¡', flag: 'ğŸ‡±ğŸ‡º' },
                            { code: '356', name: 'é©¬è€³ä»–', flag: 'ğŸ‡²ğŸ‡¹' },
                            { code: '357', name: 'å¡æµ¦è·¯æ–¯', flag: 'ğŸ‡¨ğŸ‡¾' },
                            { code: '30', name: 'å¸Œè…Š', flag: 'ğŸ‡¬ğŸ‡·' },
                            { code: '48', name: 'æ³¢å…°', flag: 'ğŸ‡µğŸ‡±' },
                            { code: '420', name: 'æ·å…‹', flag: 'ğŸ‡¨ğŸ‡¿' },
                            { code: '421', name: 'æ–¯æ´›ä¼å…‹', flag: 'ğŸ‡¸ğŸ‡°' },
                            { code: '36', name: 'åŒˆç‰™åˆ©', flag: 'ğŸ‡­ğŸ‡º' },
                            { code: '40', name: 'ç½—é©¬å°¼äºš', flag: 'ğŸ‡·ğŸ‡´' },
                            { code: '359', name: 'ä¿åŠ åˆ©äºš', flag: 'ğŸ‡§ğŸ‡¬' },
                            { code: '381', name: 'å¡å°”ç»´äºš', flag: 'ğŸ‡·ğŸ‡¸' },
                            { code: '385', name: 'å…‹ç½—åœ°äºš', flag: 'ğŸ‡­ğŸ‡·' },
                            { code: '386', name: 'æ–¯æ´›æ–‡å°¼äºš', flag: 'ğŸ‡¸ğŸ‡®' },
                            { code: '382', name: 'é»‘å±±', flag: 'ğŸ‡²ğŸ‡ª' },
                            { code: '383', name: 'åŒ—é©¬å…¶é¡¿', flag: 'ğŸ‡²ğŸ‡°' },
                            { code: '387', name: 'æ³¢é»‘', flag: 'ğŸ‡§ğŸ‡¦' },
                            { code: '389', name: 'ç§‘ç´¢æ²ƒ', flag: 'ğŸ‡½ğŸ‡°' },
                            { code: '371', name: 'æ‹‰è„±ç»´äºš', flag: 'ğŸ‡±ğŸ‡»' },
                            { code: '370', name: 'ç«‹é™¶å®›', flag: 'ğŸ‡±ğŸ‡¹' },
                            { code: '372', name: 'çˆ±æ²™å°¼äºš', flag: 'ğŸ‡ªğŸ‡ª' },
                            { code: '355', name: 'é˜¿å°”å·´å°¼äºš', flag: 'ğŸ‡¦ğŸ‡±' },
                            { code: '378', name: 'åœ£é©¬åŠ›è¯º', flag: 'ğŸ‡¸ğŸ‡²' },
                            { code: '376', name: 'å®‰é“å°”', flag: 'ğŸ‡¦ğŸ‡©' },
                            { code: '377', name: 'æ‘©çº³å“¥', flag: 'ğŸ‡²ğŸ‡¨' },
                            { code: '423', name: 'åˆ—æ”¯æ•¦å£«ç™»', flag: 'ğŸ‡±ğŸ‡®' },
                            { code: '39', name: 'æ¢µè’‚å†ˆ', flag: 'ğŸ‡»ğŸ‡¦' },
                            // åŒ—ç¾æ´²
                            { code: '1', name: 'ç¾å›½', flag: 'ğŸ‡ºğŸ‡¸' },
                            { code: '1', name: 'åŠ æ‹¿å¤§', flag: 'ğŸ‡¨ğŸ‡¦' },
                            { code: '52', name: 'å¢¨è¥¿å“¥', flag: 'ğŸ‡²ğŸ‡½' },
                            { code: '53', name: 'å¤å·´', flag: 'ğŸ‡¨ğŸ‡º' },
                            { code: '54', name: 'é˜¿æ ¹å»·', flag: 'ğŸ‡¦ğŸ‡·' },
                            { code: '55', name: 'å·´è¥¿', flag: 'ğŸ‡§ğŸ‡·' },
                            { code: '56', name: 'æ™ºåˆ©', flag: 'ğŸ‡¨ğŸ‡±' },
                            { code: '57', name: 'å“¥ä¼¦æ¯”äºš', flag: 'ğŸ‡¨ğŸ‡´' },
                            { code: '58', name: 'å§”å†…ç‘æ‹‰', flag: 'ğŸ‡»ğŸ‡ª' },
                            { code: '51', name: 'ç§˜é²', flag: 'ğŸ‡µğŸ‡ª' },
                            { code: '591', name: 'ç»åˆ©ç»´äºš', flag: 'ğŸ‡§ğŸ‡´' },
                            { code: '593', name: 'å„ç“œå¤šå°”', flag: 'ğŸ‡ªğŸ‡¨' },
                            { code: '595', name: 'å·´æ‹‰åœ­', flag: 'ğŸ‡µğŸ‡¾' },
                            { code: '598', name: 'ä¹Œæ‹‰åœ­', flag: 'ğŸ‡ºğŸ‡¾' },
                            { code: '501', name: 'ä¼¯åˆ©å…¹', flag: 'ğŸ‡§ğŸ‡¿' },
                            { code: '502', name: 'å±åœ°é©¬æ‹‰', flag: 'ğŸ‡¬ğŸ‡¹' },
                            { code: '503', name: 'è¨å°”ç“¦å¤š', flag: 'ğŸ‡¸ğŸ‡»' },
                            { code: '504', name: 'æ´ªéƒ½æ‹‰æ–¯', flag: 'ğŸ‡­ğŸ‡³' },
                            { code: '505', name: 'å°¼åŠ æ‹‰ç“œ', flag: 'ğŸ‡³ğŸ‡®' },
                            { code: '506', name: 'å“¥æ–¯è¾¾é»åŠ ', flag: 'ğŸ‡¨ğŸ‡·' },
                            { code: '507', name: 'å·´æ‹¿é©¬', flag: 'ğŸ‡µğŸ‡¦' },
                            { code: '592', name: 'ç‰¹ç«‹å°¼è¾¾å’Œå¤šå·´å“¥', flag: 'ğŸ‡¹ğŸ‡¹' },
                            { code: '1', name: 'ç‰™ä¹°åŠ ', flag: 'ğŸ‡¯ğŸ‡²' },
                            { code: '1', name: 'å¤šç±³å°¼åŠ ', flag: 'ğŸ‡©ğŸ‡´' },
                            { code: '1', name: 'æ³¢å¤šé»å„', flag: 'ğŸ‡µğŸ‡·' },
                            { code: '590', name: 'ç“œå¾·ç½—æ™®', flag: 'ğŸ‡¬ğŸ‡µ' },
                            { code: '594', name: 'æ³•å±åœ­äºšé‚£', flag: 'ğŸ‡¬ğŸ‡«' },
                            { code: '596', name: 'é©¬æå°¼å…‹', flag: 'ğŸ‡²ğŸ‡¶' },
                            { code: '597', name: 'è‹é‡Œå—', flag: 'ğŸ‡¸ğŸ‡·' },
                            { code: '599', name: 'è·å±å®‰çš„åˆ—æ–¯', flag: 'ğŸ‡§ğŸ‡¶' },
                            // éæ´²
                            { code: '20', name: 'åŸƒåŠ', flag: 'ğŸ‡ªğŸ‡¬' },
                            { code: '27', name: 'å—é', flag: 'ğŸ‡¿ğŸ‡¦' },
                            { code: '234', name: 'å°¼æ—¥åˆ©äºš', flag: 'ğŸ‡³ğŸ‡¬' },
                            { code: '233', name: 'åŠ çº³', flag: 'ğŸ‡¬ğŸ‡­' },
                            { code: '254', name: 'è‚¯å°¼äºš', flag: 'ğŸ‡°ğŸ‡ª' },
                            { code: '255', name: 'å¦æ¡‘å°¼äºš', flag: 'ğŸ‡¹ğŸ‡¿' },
                            { code: '256', name: 'ä¹Œå¹²è¾¾', flag: 'ğŸ‡ºğŸ‡¬' },
                            { code: '250', name: 'å¢æ—ºè¾¾', flag: 'ğŸ‡·ğŸ‡¼' },
                            { code: '261', name: 'é©¬è¾¾åŠ æ–¯åŠ ', flag: 'ğŸ‡²ğŸ‡¬' },
                            { code: '212', name: 'æ‘©æ´›å“¥', flag: 'ğŸ‡²ğŸ‡¦' },
                            { code: '213', name: 'é˜¿å°”åŠåˆ©äºš', flag: 'ğŸ‡©ğŸ‡¿' },
                            { code: '216', name: 'çªå°¼æ–¯', flag: 'ğŸ‡¹ğŸ‡³' },
                            { code: '218', name: 'åˆ©æ¯”äºš', flag: 'ğŸ‡±ğŸ‡¾' },
                            { code: '249', name: 'è‹ä¸¹', flag: 'ğŸ‡¸ğŸ‡©' },
                            { code: '251', name: 'åŸƒå¡ä¿„æ¯”äºš', flag: 'ğŸ‡ªğŸ‡¹' },
                            { code: '237', name: 'å–€éº¦éš†', flag: 'ğŸ‡¨ğŸ‡²' },
                            { code: '221', name: 'å¡å†…åŠ å°”', flag: 'ğŸ‡¸ğŸ‡³' },
                            { code: '225', name: 'ç§‘ç‰¹è¿ªç“¦', flag: 'ğŸ‡¨ğŸ‡®' },
                            { code: '224', name: 'å‡ å†…äºš', flag: 'ğŸ‡¬ğŸ‡³' },
                            { code: '228', name: 'å¤šå“¥', flag: 'ğŸ‡¹ğŸ‡¬' },
                            { code: '230', name: 'æ¯›é‡Œæ±‚æ–¯', flag: 'ğŸ‡²ğŸ‡º' },
                            { code: '263', name: 'æ´¥å·´å¸ƒéŸ¦', flag: 'ğŸ‡¿ğŸ‡¼' },
                            { code: '264', name: 'çº³ç±³æ¯”äºš', flag: 'ğŸ‡³ğŸ‡¦' },
                            { code: '265', name: 'é©¬æ‹‰ç»´', flag: 'ğŸ‡²ğŸ‡¼' },
                            { code: '266', name: 'åšèŒ¨ç“¦çº³', flag: 'ğŸ‡§ğŸ‡¼' },
                            { code: '268', name: 'èµæ¯”äºš', flag: 'ğŸ‡¿ğŸ‡²' },
                            { code: '267', name: 'åŸƒæ–¯ç“¦è’‚å°¼', flag: 'ğŸ‡¸ğŸ‡¿' },
                        ]
                        // æŒ‰å›½å®¶ä»£ç å»é‡
                        const unique = new Map()
                        all.forEach(c => unique.set(c.code, c))
                        return Array.from(unique.values()).sort((a, b) => a.code.localeCompare(b.code))
                    })(),

                    // Import/Export Modal
                    showImportModal: false,
                    showExportModal: false,
                    showExportAllModal: false,
                    importData: { id: '', session: '' },
                    exportData: { id: '', session: '' },
                    exportAllData: '',

                    // Template Modal
                    showTemplateModal: false,
                    templates: [],
                    newTemplate: { name: '', category: 'é—®å€™', content: '', variablesStr: '' },

                    // Schedule Modal
                    showScheduleModal: false,
                    schedules: [],
                    newSchedule: { name: '', description: '', time: '', repeat: 'daily', action: 'send_message', message: '', template_id: '', accounts: [] },
                    todayExecutions: 0,
                    pendingExecutions: 0,

                    // Forms
                    newGlobal: { protocol: 'socks5', host: '', port: 1080, username: '', password: '' },
                    newProxy: { id: '', protocol: 'socks5', host: '', port: 1080, username: '', password: '' },

                    // Toast
                    toast: { show: false, message: '', error: false }
                }
            },
            computed: {
                onlineCount() { return this.accounts.filter(a => a.status === 'online').length },
                offlineCount() { return this.accounts.filter(a => a.status !== 'online').length },
                popularCountries() {
                    return [
                        { code: '86', name: 'ä¸­å›½', flag: 'ğŸ‡¨ğŸ‡³' },
                        { code: '1', name: 'ç¾å›½', flag: 'ğŸ‡ºğŸ‡¸' },
                        { code: '852', name: 'é¦™æ¸¯', flag: 'ğŸ‡­ğŸ‡°' },
                        { code: '886', name: 'å°æ¹¾', flag: 'ğŸ‡¹ğŸ‡¼' },
                        { code: '81', name: 'æ—¥æœ¬', flag: 'ğŸ‡¯ğŸ‡µ' },
                        { code: '82', name: 'éŸ©å›½', flag: 'ğŸ‡°ğŸ‡·' },
                        { code: '65', name: 'æ–°åŠ å¡', flag: 'ğŸ‡¸ğŸ‡¬' },
                        { code: '60', name: 'é©¬æ¥è¥¿äºš', flag: 'ğŸ‡²ğŸ‡¾' }
                    ]
                },
                filteredCountries() {
                    if (!this.countrySearch) {
                        return this.countries
                    }
                    const search = this.countrySearch.toLowerCase()
                    return this.countries.filter(c =>
                        c.name.toLowerCase().includes(search) ||
                        c.code.includes(search)
                    )
                }
            },
            methods: {
                showToast(msg, error = false) {
                    this.toast = { show: true, message: msg, error }
                    setTimeout(() => this.toast.show = false, 3000)
                },
                addLog(action, account, detail = '') {
                    this.logs.push({
                        action, account, detail,
                        time: new Date().toLocaleTimeString()
                    })
                },

                async loadAccounts() {
                    try {
                        const res = await axios.get('/api/accounts')
                        this.accounts = res.data.accounts || []
                    } catch (e) { console.error(e) }
                },

                async loadProxies() {
                    try {
                        const res = await axios.get('/api/proxies')
                        this.globalProxy = res.data.global
                        this.proxies = Object.entries(res.data.proxies || {}).map(([id, p]) => ({ id, ...p }))
                    } catch (e) { console.error(e) }
                },

                async loadTemplates() {
                    try {
                        const res = await axios.get('/api/templates')
                        this.templates = res.data.templates || []
                    } catch (e) { console.error(e) }
                },

                async loadSchedules() {
                    try {
                        const res = await axios.get('/api/schedules')
                        this.schedules = Object.values(res.data.schedules || {})
                        this.updateScheduleStats()
                    } catch (e) { console.error(e) }
                },

                async loadLogs() {
                    try {
                        const res = await axios.get('/api/logs?limit=100')
                        this.logs = (res.data.logs || []).map(log => ({
                            action: log.action,
                            account: log.account,
                            detail: log.detail,
                            time: new Date(log.timestamp || log.time).toLocaleTimeString()
                        }))
                    } catch (e) { console.error(e) }
                },

                async clearLogs() {
                    if (!confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰æ—¥å¿—?')) return
                    try {
                        await axios.post('/api/logs/clear')
                        this.logs = []
                        this.showToast('æ—¥å¿—å·²æ¸…ç©º')
                    } catch (e) {
                        this.showToast('æ¸…ç©ºå¤±è´¥', true)
                    }
                },

                async loadHealth() {
                    try {
                        const res = await axios.get('/api/health/report')
                        this.health = res.data.report || {}
                        this.healthDetails = res.data.report?.details || {}
                        this.riskAccounts = res.data.report?.risk_accounts || []
                    } catch (e) { console.error(e) }
                },

                async loadStats() {
                    try {
                        const res = await axios.get('/api/stats/summary')
                        this.stats = res.data.summary || {}
                        const topRes = await axios.get('/api/stats/top', { params: { by: 'uses', limit: 5, period: 'today' } })
                        this.topAccounts = topRes.data.top_accounts || []
                    } catch (e) { console.error(e) }
                },

                // QR & Phone Login
                openQrModal() {
                    this.loginMode = 'select'
                    this.showQrModal = true
                    this.qrCode = ''
                    this.qrStatus = ''
                    this.qrError = ''
                    this.qrRemaining = 30
                },

                startQrLogin() {
                    this.loginMode = 'qr'
                    this.qrAccountId = 'account_' + Date.now()
                    this.generateQr()
                },

                startPhoneLogin() {
                    this.loginMode = 'phone'
                    this.phoneStep = 'input'
                    this.phoneAccountId = 'account_' + Date.now()
                    this.phoneData = { phone: '', code: '', password: '' }
                    this.phoneError = ''
                },

                closeQrModal() {
                    this.stopQrPolling()
                    this.showQrModal = false
                    this.loginMode = 'select'
                    this.twoFaPassword = ''
                    this.twoFaError = ''
                    this.phoneData = { phone: '', code: '', password: '' }
                    this.phoneError = ''
                    this.loadAccounts()
                },

                // QR Login Methods
                async generateQr() {
                    try {
                        const res = await axios.post('/api/accounts/generate-qr', { account_id: this.qrAccountId })
                        if (res.data.success) {
                            this.qrCode = res.data.qr_code
                            this.qrStatus = 'waiting'
                            this.qrRemaining = 30
                            this.startQrPolling()
                            this.addLog('ç”ŸæˆäºŒç»´ç ', this.qrAccountId)
                        } else {
                            this.qrStatus = 'error'
                            this.qrError = res.data.error || 'ç”Ÿæˆå¤±è´¥'
                        }
                    } catch (e) {
                        this.qrStatus = 'error'
                        this.qrError = e.response?.data?.detail || e.response?.data?.error || 'è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ä»£ç†'
                    }
                },

                startQrPolling() {
                    this.qrPolling = setInterval(async () => {
                        this.qrRemaining -= 1
                        try {
                            const res = await axios.get(`/api/accounts/${this.qrAccountId}/qr-status`)
                            if (res.data.status === 'success') {
                                this.qrStatus = 'success'
                                this.stopQrPolling()
                                this.showToast('ç™»å½•æˆåŠŸï¼')
                                this.addLog('ç™»å½•æˆåŠŸ', this.qrAccountId)
                                this.loadAccounts()
                                setTimeout(() => this.closeQrModal(), 1500)
                            } else if (res.data.status === 'need_password') {
                                this.qrStatus = 'need_password'
                                this.stopQrPolling()
                            } else if (this.qrRemaining <= 0) {
                                this.qrStatus = 'timeout'
                                this.stopQrPolling()
                            }
                        } catch (e) { console.error(e) }
                    }, 1000)
                },

                stopQrPolling() {
                    if (this.qrPolling) {
                        clearInterval(this.qrPolling)
                        this.qrPolling = null
                    }
                },

                async refreshQr() {
                    this.stopQrPolling()
                    this.qrCode = ''
                    this.qrStatus = ''
                    this.twoFaPassword = ''
                    this.twoFaError = ''
                    this.qrAccountId = 'account_' + Date.now()
                    await this.generateQr()
                },

                async submit2FA() {
                    if (!this.twoFaPassword) return
                    this.twoFaLoading = true
                    this.twoFaError = ''
                    try {
                        const res = await axios.post(`/api/accounts/${this.qrAccountId}/2fa-password`, {
                            password: this.twoFaPassword
                        })
                        if (res.data.success) {
                            this.qrStatus = 'success'
                            this.showToast('ç™»å½•æˆåŠŸï¼')
                            this.addLog('ç™»å½•æˆåŠŸ(2FA)', this.qrAccountId)
                            this.loadAccounts()
                            setTimeout(() => this.closeQrModal(), 1500)
                        } else {
                            this.twoFaError = res.data.error || 'å¯†ç é”™è¯¯'
                        }
                    } catch (e) {
                        this.twoFaError = e.response?.data?.detail || 'éªŒè¯å¤±è´¥'
                    }
                    this.twoFaLoading = false
                },

                // Phone Login Methods
                async sendPhoneCode() {
                    if (!this.phoneData.countryCode || !this.phoneData.phone) return
                    this.phoneLoading = true
                    this.phoneError = ''
                    try {
                        // ç»„åˆå®Œæ•´çš„æ‰‹æœºå·ï¼ˆå›½å®¶ä»£ç +æ‰‹æœºå·ï¼‰
                        const fullPhone = '+' + this.phoneData.countryCode + this.phoneData.phone
                        const res = await axios.post('/api/accounts/send-code', {
                            account_id: this.phoneAccountId,
                            phone: fullPhone
                        })
                        if (res.data.success) {
                            this.phoneStep = 'code'
                            this.addLog('å‘é€éªŒè¯ç ', fullPhone)
                        } else {
                            this.phoneError = res.data.error || 'å‘é€å¤±è´¥'
                        }
                    } catch (e) {
                        this.phoneError = e.response?.data?.detail || e.response?.data?.error || 'è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ä»£ç†'
                    }
                    this.phoneLoading = false
                },

                async verifyPhoneCode() {
                    if (!this.phoneData.code) return
                    this.phoneLoading = true
                    this.phoneError = ''
                    try {
                        const res = await axios.post('/api/accounts/verify-code', {
                            account_id: this.phoneAccountId,
                            code: this.phoneData.code
                        })
                        if (res.data.success) {
                            this.phoneStep = 'success'
                            this.showToast('ç™»å½•æˆåŠŸï¼')
                            this.addLog('æ‰‹æœºå·ç™»å½•æˆåŠŸ', this.phoneAccountId)
                            this.loadAccounts()
                            setTimeout(() => this.closeQrModal(), 1500)
                        } else if (res.data.needs_2fa) {
                            this.phoneStep = '2fa'
                        } else {
                            this.phoneError = res.data.error || 'éªŒè¯å¤±è´¥'
                        }
                    } catch (e) {
                        this.phoneError = e.response?.data?.detail || e.response?.data?.error || 'éªŒè¯å¤±è´¥'
                    }
                    this.phoneLoading = false
                },

                async submitPhone2FA() {
                    if (!this.phoneData.password) return
                    this.phoneLoading = true
                    this.phoneError = ''
                    try {
                        const res = await axios.post(`/api/accounts/${this.phoneAccountId}/phone-2fa`, {
                            password: this.phoneData.password
                        })
                        if (res.data.success) {
                            this.phoneStep = 'success'
                            this.showToast('ç™»å½•æˆåŠŸï¼')
                            this.addLog('æ‰‹æœºå·ç™»å½•æˆåŠŸ(2FA)', this.phoneAccountId)
                            this.loadAccounts()
                            setTimeout(() => this.closeQrModal(), 1500)
                        } else {
                            this.phoneError = res.data.error || 'å¯†ç é”™è¯¯'
                        }
                    } catch (e) {
                        this.phoneError = e.response?.data?.detail || 'éªŒè¯å¤±è´¥'
                    }
                    this.phoneLoading = false
                },

                async cancelPhoneLogin() {
                    try {
                        await axios.delete(`/api/accounts/${this.phoneAccountId}/phone-login`)
                        this.closeQrModal()
                    } catch (e) {
                        this.closeQrModal()
                    }
                },

                // Account
                async deleteAccount(id) {
                    if (!confirm(`ç¡®å®šåˆ é™¤è´¦å· ${id}?`)) return
                    try {
                        await axios.delete(`/api/accounts/${id}`)
                        this.showToast('è´¦å·å·²åˆ é™¤')
                        this.addLog('åˆ é™¤è´¦å·', id)
                        this.loadAccounts()
                    } catch (e) {
                        this.showToast(e.response?.data?.detail || 'åˆ é™¤å¤±è´¥', true)
                    }
                },

                async exportSession(id) {
                    try {
                        const res = await axios.get(`/api/accounts/${id}/export-session`)
                        this.exportData = { id, session: res.data.session_string }
                        this.showExportModal = true
                        this.addLog('å¯¼å‡ºSession', id)
                    } catch (e) {
                        this.showToast('å¯¼å‡ºå¤±è´¥', true)
                    }
                },

                copyAccountId(accountId) {
                    navigator.clipboard.writeText(accountId).then(() => {
                        this.showToast(`âœ… å·²å¤åˆ¶: ${accountId}`)
                    }).catch(() => {
                        // é™çº§æ–¹æ¡ˆ
                        const textarea = document.createElement('textarea')
                        textarea.value = accountId
                        textarea.style.position = 'fixed'
                        textarea.style.opacity = '0'
                        document.body.appendChild(textarea)
                        textarea.select()
                        try {
                            document.execCommand('copy')
                            this.showToast(`âœ… å·²å¤åˆ¶: ${accountId}`)
                        } catch (e) {
                            this.showToast('å¤åˆ¶å¤±è´¥', true)
                        }
                        document.body.removeChild(textarea)
                    })
                },

                copyExport() {
                    navigator.clipboard.writeText(this.exportData.session)
                    this.showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
                },

                copyExportAll() {
                    navigator.clipboard.writeText(this.exportAllData)
                    this.showToast('å·²å¤åˆ¶å…¨éƒ¨')
                },

                async importSession() {
                    try {
                        await axios.post('/api/accounts/add-session', {
                            account_id: this.importData.id,
                            session_string: this.importData.session
                        })
                        this.showToast('å¯¼å…¥æˆåŠŸ')
                        this.addLog('å¯¼å…¥Session', this.importData.id)
                        this.showImportModal = false
                        this.importData = { id: '', session: '' }
                        this.loadAccounts()
                    } catch (e) {
                        this.showToast(e.response?.data?.detail || 'å¯¼å…¥å¤±è´¥', true)
                    }
                },

                // Proxy
                async setGlobalProxy() {
                    try {
                        await axios.post('/api/proxies/set-global', this.newGlobal)
                        this.showToast('å…¨å±€ä»£ç†è®¾ç½®æˆåŠŸ')
                        this.addLog('è®¾ç½®å…¨å±€ä»£ç†', `${this.newGlobal.host}:${this.newGlobal.port}`)
                        this.newGlobal = { protocol: 'socks5', host: '', port: 1080, username: '', password: '' }
                        this.loadProxies()
                    } catch (e) {
                        this.showToast('è®¾ç½®å¤±è´¥', true)
                    }
                },

                async removeGlobalProxy() {
                    try {
                        await axios.delete('/api/proxies/global')
                        this.showToast('å…¨å±€ä»£ç†å·²ç§»é™¤')
                        this.addLog('ç§»é™¤å…¨å±€ä»£ç†', '-')
                        this.loadProxies()
                    } catch (e) {
                        this.showToast('ç§»é™¤å¤±è´¥', true)
                    }
                },

                async testGlobalProxy() {
                    this.testing = true
                    try {
                        const res = await axios.post('/api/proxies/test')
                        const result = res.data.results?.global
                        if (result?.success) {
                            this.showToast(`è¿æ¥æˆåŠŸï¼å“åº”: ${result.response_time.toFixed(0)}ms`)
                        } else {
                            this.showToast(result?.error || 'è¿æ¥å¤±è´¥', true)
                        }
                    } catch (e) {
                        this.showToast('æµ‹è¯•å¤±è´¥', true)
                    }
                    this.testing = false
                },

                async addProxy() {
                    try {
                        await axios.post('/api/proxies/add', {
                            proxy_id: this.newProxy.id,
                            protocol: this.newProxy.protocol,
                            host: this.newProxy.host,
                            port: this.newProxy.port,
                            username: this.newProxy.username,
                            password: this.newProxy.password
                        })
                        this.showToast('ä»£ç†æ·»åŠ æˆåŠŸ')
                        this.addLog('æ·»åŠ ä»£ç†', this.newProxy.id)
                        this.newProxy = { id: '', protocol: 'socks5', host: '', port: 1080, username: '', password: '' }
                        this.loadProxies()
                    } catch (e) {
                        this.showToast('æ·»åŠ å¤±è´¥', true)
                    }
                },

                async deleteProxy(id) {
                    if (!confirm(`ç¡®å®šåˆ é™¤ä»£ç† ${id}?`)) return
                    try {
                        await axios.delete(`/api/proxies/${id}`)
                        this.showToast('ä»£ç†å·²åˆ é™¤')
                        this.addLog('åˆ é™¤ä»£ç†', id)
                        this.loadProxies()
                    } catch (e) {
                        this.showToast('åˆ é™¤å¤±è´¥', true)
                    }
                },

                async testProxy(id) {
                    try {
                        const res = await axios.post('/api/proxies/test', null, { params: { proxy_id: id } })
                        const result = res.data.result
                        if (result?.success) {
                            this.showToast(`è¿æ¥æˆåŠŸï¼å“åº”: ${result.response_time.toFixed(0)}ms`)
                        } else {
                            this.showToast(result?.error || 'è¿æ¥å¤±è´¥', true)
                        }
                    } catch (e) {
                        this.showToast('æµ‹è¯•å¤±è´¥', true)
                    }
                },

                // Templates
                async addTemplate() {
                    const variables = this.newTemplate.variablesStr
                        ? this.newTemplate.variablesStr.split(',').map(v => v.trim()).filter(v => v)
                        : []
                    const name = this.newTemplate.name || ('æ¨¡æ¿' + (this.templates.length + 1))
                    const template_id = 'tpl_' + Date.now()
                    try {
                        await axios.post('/api/templates', {
                            template_id,
                            name,
                            content: this.newTemplate.content,
                            category: this.newTemplate.category,
                            variables
                        })
                        this.showToast('æ¨¡æ¿æ·»åŠ æˆåŠŸ')
                        this.addLog('æ·»åŠ æ¨¡æ¿', name)
                        this.showTemplateModal = false
                        this.newTemplate = { name: '', category: 'é—®å€™', content: '', variablesStr: '' }
                        await this.loadTemplates()
                    } catch (e) {
                        this.showToast(e.response?.data?.detail || 'æ·»åŠ å¤±è´¥', true)
                    }
                },

                async addQuickTemplate(name, content) {
                    const template_id = 'tpl_' + Date.now()
                    try {
                        await axios.post('/api/templates', {
                            template_id,
                            name,
                            content,
                            category: 'å¿«æ·',
                            variables: []
                        })
                        this.showToast(`å·²æ·»åŠ "${name}"æ¨¡æ¿`)
                        await this.loadTemplates()
                    } catch (e) {
                        this.showToast('æ·»åŠ å¤±è´¥', true)
                    }
                },

                async deleteTemplate(i) {
                    if (!confirm('ç¡®å®šåˆ é™¤æ­¤æ¨¡æ¿?')) return
                    const tpl = this.templates[i]
                    try {
                        await axios.delete(`/api/templates/${tpl.template_id || tpl.id}`)
                        this.showToast('æ¨¡æ¿å·²åˆ é™¤')
                        this.addLog('åˆ é™¤æ¨¡æ¿', tpl.name)
                        await this.loadTemplates()
                    } catch (e) {
                        this.showToast('åˆ é™¤å¤±è´¥', true)
                    }
                },

                copyTemplate(tpl) {
                    navigator.clipboard.writeText(tpl.content)
                    this.showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
                },

                // Schedules
                async addSchedule() {
                    const schedule_id = 'sched_' + Date.now()
                    // Convert time to cron format
                    const [hours, minutes] = this.newSchedule.time.split(':')
                    let cron = `${minutes} ${hours} * * *`
                    if (this.newSchedule.repeat === 'weekly') {
                        cron = `${minutes} ${hours} * * 1`
                    } else if (this.newSchedule.repeat === 'hourly') {
                        cron = `0 * * * *`
                    }

                    try {
                        await axios.post('/api/schedules', {
                            schedule_id,
                            name: this.newSchedule.name,
                            cron,
                            action: this.newSchedule.action === 'send_message' ? 'send_message' : 'send_template',
                            target: 'all', // For simplicity
                            message: this.newSchedule.message,
                            template_id: this.newSchedule.template_id,
                            account_ids: this.newSchedule.accounts,
                            enabled: true
                        })
                        this.showToast('å®šæ—¶è®¡åˆ’æ·»åŠ æˆåŠŸ')
                        this.addLog('æ·»åŠ å®šæ—¶è®¡åˆ’', this.newSchedule.name)
                        this.showScheduleModal = false
                        this.newSchedule = { name: '', description: '', time: '', repeat: 'daily', action: 'send_message', message: '', template_id: '', accounts: [] }
                        await this.loadSchedules()
                    } catch (e) {
                        this.showToast(e.response?.data?.detail || 'æ·»åŠ å¤±è´¥', true)
                    }
                },

                async toggleSchedule(i) {
                    const sched = this.schedules[i]
                    try {
                        await axios.post(`/api/schedules/${sched.schedule_id}/toggle`)
                        sched.enabled = !sched.enabled
                        this.showToast(sched.enabled ? 'è®¡åˆ’å·²å¯ç”¨' : 'è®¡åˆ’å·²ç¦ç”¨')
                        this.updateScheduleStats()
                    } catch (e) {
                        this.showToast('æ“ä½œå¤±è´¥', true)
                    }
                },

                async deleteSchedule(i) {
                    if (!confirm('ç¡®å®šåˆ é™¤æ­¤è®¡åˆ’?')) return
                    const sched = this.schedules[i]
                    try {
                        await axios.delete(`/api/schedules/${sched.schedule_id}`)
                        this.showToast('è®¡åˆ’å·²åˆ é™¤')
                        this.addLog('åˆ é™¤å®šæ—¶è®¡åˆ’', sched.name)
                        await this.loadSchedules()
                    } catch (e) {
                        this.showToast('åˆ é™¤å¤±è´¥', true)
                    }
                },

                updateScheduleStats() {
                    this.pendingExecutions = this.schedules.filter(s => s.enabled).length
                    // ç®€å•ç»Ÿè®¡ä»Šæ—¥æ‰§è¡Œæ•°
                    const today = new Date().toDateString()
                    this.todayExecutions = this.schedules.filter(s => 
                        s.lastRun && new Date(s.lastRun).toDateString() === today
                    ).length
                },

                formatTime(t) {
                    if (!t || t === 'N/A') return '-'
                    try {
                        const d = new Date(t)
                        const diff = (Date.now() - d) / 1000
                        if (diff < 60) return 'åˆšåˆš'
                        if (diff < 3600) return Math.floor(diff / 60) + 'åˆ†é’Ÿå‰'
                        if (diff < 86400) return Math.floor(diff / 3600) + 'å°æ—¶å‰'
                        return Math.floor(diff / 86400) + 'å¤©å‰'
                    } catch { return '-' }
                }
            },
            watch: {
                showExportAllModal(v) {
                    if (v) {
                        this.exportAllData = JSON.stringify(this.accounts.map(a => ({
                            account_id: a.account_id,
                            username: a.username,
                            user_id: a.user_id
                        })), null, 2)
                    }
                }
            },
            mounted() {
                this.loadAccounts()
                this.loadProxies()
                this.loadHealth()
                this.loadStats()
                this.loadTemplates()
                this.loadSchedules()
                this.loadLogs()
                this.updateScheduleStats()
                setInterval(() => {
                    this.loadAccounts()
                    this.loadHealth()
                }, 30000)
            }
        }).mount('#app')
    </script>
</body>
</html>
